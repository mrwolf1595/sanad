# دليل اختبار إصلاحات PDF

## خطوات الاختبار السريع

### 1. التأكد من الإصلاحات في الكود
```bash
# اختبار معالجة النصوص العربية
node test-pdf-generation.js
```

يجب أن ترى:
- ✅ النصوص العربية معالجة بشكل صحيح
- ✅ الأرقام محولة للصيغة الغربية
- ✅ التواريخ منسقة بشكل DD-MM-YYYY

### 2. تشغيل التطبيق
```bash
npm run dev
```

### 3. اختبار توليد PDF

#### الطريقة الأولى: إنشاء سند جديد
1. افتح المتصفح على http://localhost:3000
2. سجل دخول أو أنشئ حساب جديد
3. اذهب إلى "إضافة سند جديد"
4. املأ البيانات التالية:

**بيانات الاختبار:**
- نوع السند: قبض أو صرف
- اسم المستلم: محمد أحمد السعيد
- رقم الهوية (من): 1234567890
- رقم الهوية (إلى): 0987654321
- المبلغ: 5000
- طريقة الدفع: نقداً
- الوصف: دفعة مقدمة لمشروع الرياض

5. اضغط "حفظ"
6. اضغط "تحميل PDF"

#### الطريقة الثانية: استخدام سند موجود
1. اذهب إلى "السندات"
2. اختر أي سند موجود
3. اضغط "تحميل PDF"

### 4. التحقق من PDF

افتح الملف المُحمّل وتحقق من:

#### ✅ النصوص العربية:
- [ ] جميع النصوص العربية واضحة ومتصلة
- [ ] لا توجد حروف مقطعة أو معكوسة
- [ ] اتجاه النص من اليمين لليسار

#### ✅ الأرقام:
- [ ] الأرقام تظهر بالصيغة الصحيحة (0-9)
- [ ] رقم السند واضح (مثال: 10000-CER)
- [ ] الرقم الضريبي والسجل التجاري واضحين
- [ ] أرقام الهوية واضحة

#### ✅ التاريخ:
- [ ] التاريخ بصيغة DD-MM-YYYY
- [ ] التاريخ واضح وقابل للقراءة

#### ✅ التنسيق العام:
- [ ] الخط واضح (Cairo)
- [ ] جميع الحقول في مكانها الصحيح
- [ ] الشعار يظهر (إن وُجد)
- [ ] الختم يظهر (إن وُجد)

### 5. اختبار حالات خاصة

#### اختبار 1: نصوص طويلة
- اسم المستلم: محمد أحمد عبدالله بن سعيد الشهري
- الوصف: دفعة مقدمة للمشروع التجاري في حي الملقا بالرياض طبقاً للعقد رقم 2024/12345

#### اختبار 2: أرقام عربية (إن كانت موجودة في البيانات)
- المبلغ: ١٠٠٠ (يجب أن يتحول لـ 1000)

#### اختبار 3: طرق دفع مختلفة
- نقداً
- شيك (مع رقم الشيك واسم البنك)
- تحويل بنكي (مع رقم التحويل واسم البنك)

### 6. اختبار الأداء

- [ ] توليد PDF يستغرق أقل من 3 ثواني
- [ ] الملف يُحمّل بدون أخطاء
- [ ] الملف يفتح في جميع برامج PDF (Adobe, Chrome, Edge)

## المشاكل المحتملة وحلولها

### المشكلة: النصوص ما زالت مقطعة
**الحل:**
```bash
# تأكد من تثبيت المكتبات
npm install arabic-persian-reshaper @pdf-lib/fontkit

# أعد تشغيل الخادم
npm run dev
```

### المشكلة: الخط غير واضح
**الحل:**
تأكد من وجود الخط في:
```
public/fonts/Cairo-Regular.ttf
```

### المشكلة: التاريخ بصيغة خاطئة
**التأكد:**
- في قاعدة البيانات، التاريخ يُخزّن بصيغة YYYY-MM-DD
- في PDF، يُعرض بصيغة DD-MM-YYYY

### المشكلة: PDF لا يُحمّل
**الحل:**
1. تحقق من console المتصفح
2. تحقق من terminal الخادم
3. تحقق من Storage في Supabase
4. تأكد من وجود Policy للـ Storage

## تحديث copilot-instructions.md

بعد التأكد من نجاح الاختبارات، حدّث:

```markdown
- [x] إصلاح مشاكل PDF بشكل نهائي
  - [x] معالجة النصوص العربية
  - [x] تحويل الأرقام العربية
  - [x] تنسيق التاريخ
  - [x] تحسين الخط
  - [x] اختبار جميع الحالات
```

## الخلاصة

جميع إصلاحات PDF تمت بنجاح ✅

المشروع جاهز للاستخدام والإنتاج!
